@section Styles {
    <style>

    </style>
}
<div class="container-xxl flex-grow-1 container-p-y">
    <a class="btn btn-sm btn-success" href="/User/Create">新增</a>

    <table id="userTable" class="table table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Account</th>
                <th>Email</th>
                <th>Name</th>
                <th>Mobile</th>
                <th>Birthday</th>
            </tr>
        </thead>
        <tbody>
            <!-- 數據將通過 AJAX 加載 -->
        </tbody>
    </table>
</div>


@section Scripts {
    <script>
        $(async()=>{

            // 定義 DataTable 的欄位配置
            let columns = [
                {
                    "data": null, // 使用 null 以便自定義渲染
                    "title": "#", // 標題
                    "orderable": false, // 禁用排序功能
                    "render": function(data, type, row) {
                        // 返回按鈕，並將用戶 ID 作為參數
                        let btn = `<a href="/User/Detail/${row.id}" class="btn btn-primary btn-sm">檢視</a>`;
                        btn += `<a href="/User/Edit/${row.id}" class="btn btn-warning btn-sm ms-2">編輯</a>`;
                        btn += `<a href="/User/Delete/${row.id}" class="btn btn-danger btn-sm ms-2">刪除</a>`;
                        return btn;
                    }
                },
                { "data": "account", "title": "帳號" },      // Account 欄位，顯示用戶帳號
                { "data": "email", "title": "電子郵件" },    // Email 欄位，顯示用戶電子郵件
                { "data": "name", "title": "姓名" },          // Name 欄位，顯示用戶姓名
                { "data": "mobile", "title": "手機" },        // Mobile 欄位，顯示用戶手機號碼
                {
                    "data": "birthday",
                    "title": "生日",
                    "render": function(data, type, row) {
                        // 格式化生日顯示
                        return moment(data).format('YYYY-MM-DD'); // 使用 moment.js 格式化日期為 YYYY-MM-DD 格式
                    }
                }
            ];

            // 初始化 DataTable
            $('#userTable').DataTable({
                // 定義 DataTable 的 DOM 結構
                "dom": "<'row row-filter m-2'f><'row row-length m-2'l>rt<'row row-info m-2 d-flex justify-content-between'ip>",

                // 自動調整列寬
                "autoWidth": false,

                // 設定欄位配置
                "columns": columns, // 使用定義的 columns 變數

                // 設定語言文件的 URL
                "language": {
                    "url": '/langs/datatables.zh-tw.json', // 指定 DataTables 的語言文件
                },

                // 設定每頁顯示的選項
                "lengthMenu": [[5, 10, 20, 30, 40, 50], [5, 10, 20, 30, 40, 50]],

                // 啟用分頁功能
                "paging": true,

                // 設定每頁的預設顯示數量
                "pageLength": 10,

                // 啟用處理指示器
                "processing": true,

                // 啟用伺服器端處理
                "serverSide": true,

                // AJAX 請求配置
                "ajax": {
                    "url": `/User/GetData`, // 請求的 URL
                    "type": "POST", // 請求方法
                },

                // 啟用列重排功能
                "colReorder": { realtime: false },

                // 啟用排序功能
                "ordering": true,

                // 設定初始排序
                "order": [],

                // 畫面繪製後的回調函數
                "drawCallback": function () {
                    // 獲取當前 DataTable 的 AJAX 返回的 JSON 數據
                    let json = $('#userTable').DataTable().ajax.json();

                    // 檢查 JSON 是否為 null 或 undefined
                    if (json === null || json === undefined) {
                        return; // 如果是，則不執行後續操作
                    }

                    // 檢查是否有錯誤信息
                    if (json.errorMessage !== null && json.errorMessage !== undefined && json.errorMessage.length > 0) {
                        alert(json.errorMessage); // 如果有錯誤信息，則顯示警告
                        return; // 結束函數
                    }
                }
            });

        });
    </script>
}
